#!/bin/bash


export JOB_NAME=cubrid
export JOB_DIR=/var/vcap/jobs/${JOB_NAME}
export PKG_DIR=/var/vcap/packages/${JOB_NAME}
export DATA_DIR=/var/vcap/data/packages/${JOB_NAME}
export RUN_DIR=/var/vcap/sys/run/${JOB_NAME}
export LOG_DIR=/var/vcap/sys/log/${JOB_NAME}
export STORE_DIR=/var/vcap/store

if [ ! $CUBRID ]
then
  . /var/vcap/jobs/cubrid/config/.cubrid.sh
fi


case $1 in

  start)
    if [ ! -d $CUBRID_DATABASES/cubrid_database ]; then
      cp -a $PKG_DIR/CUBRID $STORE_DIR
      mkdir -p $CUBRID_DATABASES/cubrid_database
      ln -sf $JOB_DIR/config/cubrid.conf $STORE_DIR/CUBRID/conf/cubrid.conf
      ln -sf $STORE_DIR/CUBRID $LOG_DIR
    fi


    sleep 30

    cubrid service start

    ;;

  stop)
    cubrid service stop
    ;;

  *)
    echo "Usage: cubrid_ctl {start|stop}" ;;

esac
